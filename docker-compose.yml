services:
  postgres:
    image: postgres:15
    container_name: guess_the_worth_db
    environment:
      POSTGRES_DB: guess_the_worth_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  backend:
    build: ./backend
    container_name: guess_the_worth_backend
    ports:
      - "8000:8000"
    environment:
      # Put env variables either here or in /backend/.env

      # Database Configuration
        DATABASE_URL: postgresql://postgres:password@guess_the_worth_db:5432/guess_the_worth_db

      #JWT
      #JWT_SECRET_KEY: your-super-secret-jwt-key-change-in-production

      # Auth0 Configuration
      #AUTH0_DOMAIN: guess-the-worth.eu.auth0.com
      #AUTH0_CLIENT_ID: your-auth0-client-id
      #AUTH0_CLIENT_SECRET: your-super-secret-auth0-key
      #AUTH0_AUDIENCE: https://api.guesstheworth.com

      # Stripe Configuration (Test Mode)
      #STRIPE_SECRET_KEY: sk_test_your_stripe_secret_key
      #STRIPE_PUBLISHABLE_KEY: pk_test_your_stripe_publishable_key
      #STRIPE_WEBHOOK_SECRET: whsec_your_webhook_secret

      # Application Configuration
      #SECRET_KEY: your-super-secret-key-change-this-in-production
      #ALGORITHM: HS256
      #ACCESS_TOKEN_EXPIRE_MINUTES: 30

      # File Upload Configuration
      #UPLOAD_DIR: ./uploads
      #MAX_FILE_SIZE: 10485760  # 10MB in bytes

      # Environment
      #ENVIRONMENT: development

      # CORS Origins (comma separated)
      #CORS_ORIGINS: http://localhost:5173,http://localhost:3000
    depends_on:
      postgres:
        condition: service_healthy
    volumes:
      - ./backend:/app
    command: uvicorn main:socket_app --host 0.0.0.0 --port 8000 --reload

  frontend:
    build: ./frontend
    container_name: guess_the_worth_frontend
    ports:
      - "5173:5173"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    command: npm run dev -- --host 0.0.0.0
    depends_on:
      - backend

volumes:
  postgres_data: