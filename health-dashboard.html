<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guess The Worth - Health Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }

      header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .service-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .service-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      }

      .service-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .service-name {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2d3748;
      }

      .status-indicator {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      .status-indicator.checking {
        background-color: #fbbf24;
      }

      .status-indicator.healthy {
        background-color: #10b981;
      }

      .status-indicator.degraded {
        background-color: #f59e0b;
      }

      .status-indicator.down {
        background-color: #ef4444;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .service-details {
        margin-top: 15px;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .detail-row:last-child {
        border-bottom: none;
      }

      .detail-label {
        color: #6b7280;
        font-size: 0.9rem;
      }

      .detail-value {
        font-weight: 600;
        color: #1f2937;
      }

      .detail-value.status-healthy {
        color: #10b981;
      }

      .detail-value.status-degraded {
        color: #f59e0b;
      }

      .detail-value.status-down {
        color: #ef4444;
      }

      .endpoint-url {
        font-size: 0.85rem;
        color: #6b7280;
        margin-top: 10px;
        word-break: break-all;
      }

      .controls {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        text-align: center;
      }

      .controls button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s ease;
        margin: 5px;
      }

      .controls button:hover {
        background: #5568d3;
      }

      .controls button:active {
        transform: scale(0.98);
      }

      .last-updated {
        margin-top: 15px;
        color: #6b7280;
        font-size: 0.9rem;
      }

      .config-warning {
        background: #fef3c7;
        border-left: 4px solid #f59e0b;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        color: #92400e;
      }

      .config-warning strong {
        display: block;
        margin-bottom: 5px;
      }

      footer {
        text-align: center;
        color: white;
        margin-top: 40px;
        padding: 20px;
        font-size: 0.9rem;
        opacity: 0.8;
      }

      @media (max-width: 768px) {
        header h1 {
          font-size: 2rem;
        }

        .dashboard {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üé® Guess The Worth</h1>
        <p>Service Health Dashboard</p>
      </header>

      <div id="configWarning" class="config-warning" style="display: none">
        <strong>‚ö†Ô∏è Configuration Required</strong>
        <p>
          Please update the service URLs in the configuration section of this
          file.
        </p>
      </div>

      <div class="dashboard" id="dashboard">
        <!-- Service cards will be inserted here by JavaScript -->
      </div>

      <div class="controls">
        <button onclick="checkAllServices()">üîÑ Refresh Now</button>
        <button onclick="toggleAutoRefresh()">
          <span id="autoRefreshText">‚è∏Ô∏è Pause Auto-Refresh</span>
        </button>
        <div class="last-updated">
          Last updated: <span id="lastUpdated">Never</span>
        </div>
      </div>

      <footer>
        <p>
          üí° This dashboard checks your services in real-time from your browser.
        </p>
        <p>Keep this page open to monitor service health continuously.</p>
      </footer>
    </div>

    <script>
      // ============================================
      // CONFIGURATION - Update these URLs
      // ============================================
      const CONFIG = {
        // Replace with your actual Azure App Service names
        backendUrl: "YOUR-BACKEND-APP-NAME.azurewebsites.net",
        frontendUrl: "YOUR-FRONTEND-APP-NAME.azurewebsites.net",

        // Check interval in milliseconds (30 seconds by default)
        checkInterval: 30000,

        // Request timeout in milliseconds
        timeout: 15000,
      };

      // Service definitions
      const services = [
        {
          id: "backend-health",
          name: "Backend API",
          url: `https://${CONFIG.backendUrl}/health`,
          expectedStatus: 200,
          checkType: "json",
          icon: "üöÄ",
        },
        {
          id: "backend-db",
          name: "Database Connection",
          url: `https://${CONFIG.backendUrl}/health/db`,
          expectedStatus: 200,
          checkType: "json",
          icon: "üóÑÔ∏è",
        },
        {
          id: "frontend",
          name: "Frontend Application",
          url: `https://${CONFIG.frontendUrl}`,
          expectedStatus: 200,
          checkType: "html",
          icon: "üé®",
        },
      ];

      // ============================================
      // STATE MANAGEMENT
      // ============================================
      let autoRefreshEnabled = true;
      let autoRefreshInterval = null;
      let serviceStates = {};

      // ============================================
      // INITIALIZATION
      // ============================================
      document.addEventListener("DOMContentLoaded", () => {
        checkConfiguration();
        initializeDashboard();
        checkAllServices();
        startAutoRefresh();
      });

      function checkConfiguration() {
        const isConfigured =
          !CONFIG.backendUrl.includes("YOUR-") &&
          !CONFIG.frontendUrl.includes("YOUR-");

        const warningEl = document.getElementById("configWarning");
        if (!isConfigured) {
          warningEl.style.display = "block";
        }
      }

      function initializeDashboard() {
        const dashboard = document.getElementById("dashboard");

        services.forEach((service) => {
          const card = createServiceCard(service);
          dashboard.appendChild(card);

          // Initialize state
          serviceStates[service.id] = {
            status: "checking",
            responseTime: null,
            lastCheck: null,
            error: null,
          };
        });
      }

      function createServiceCard(service) {
        const card = document.createElement("div");
        card.className = "service-card";
        card.id = `card-${service.id}`;

        card.innerHTML = `
                <div class="service-header">
                    <div class="service-name">${service.icon} ${service.name}</div>
                    <div class="status-indicator checking" id="indicator-${service.id}"></div>
                </div>
                <div class="service-details">
                    <div class="detail-row">
                        <span class="detail-label">Status</span>
                        <span class="detail-value" id="status-${service.id}">Checking...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Response Time</span>
                        <span class="detail-value" id="response-${service.id}">‚Äî</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Last Check</span>
                        <span class="detail-value" id="lastcheck-${service.id}">‚Äî</span>
                    </div>
                </div>
                <div class="endpoint-url" title="${service.url}">
                    ${service.url}
                </div>
            `;

        return card;
      }

      // ============================================
      // HEALTH CHECKING
      // ============================================
      async function checkAllServices() {
        const checkPromises = services.map((service) => checkService(service));
        await Promise.all(checkPromises);
        updateLastUpdatedTime();
      }

      async function checkService(service) {
        const startTime = Date.now();

        try {
          // Use a proxy approach for CORS-free checking
          // Note: This method may be blocked by CORS. For production, consider:
          // 1. Adding CORS headers to your backend
          // 2. Using a proxy service
          // 3. Making this a backend service

          const controller = new AbortController();
          const timeoutId = setTimeout(
            () => controller.abort(),
            CONFIG.timeout,
          );

          const response = await fetch(service.url, {
            method: "GET",
            mode: "cors", // Will work if CORS is enabled
            signal: controller.signal,
            cache: "no-cache",
          });

          clearTimeout(timeoutId);
          const responseTime = Date.now() - startTime;

          const isHealthy = response.status === service.expectedStatus;
          const isDegraded = responseTime > 2000; // Slow response

          updateServiceState(service.id, {
            status: isHealthy ? (isDegraded ? "degraded" : "healthy") : "down",
            responseTime,
            lastCheck: new Date(),
            error: null,
          });
        } catch (error) {
          const responseTime = Date.now() - startTime;

          // Check if it's a CORS error (which might mean service is up but CORS not configured)
          const isCorsError =
            error.message.includes("CORS") || error.name === "TypeError";

          updateServiceState(service.id, {
            status: isCorsError ? "degraded" : "down",
            responseTime,
            lastCheck: new Date(),
            error: isCorsError
              ? "CORS not configured (service may be running)"
              : error.message,
          });
        }
      }

      function updateServiceState(serviceId, state) {
        serviceStates[serviceId] = { ...serviceStates[serviceId], ...state };
        updateServiceUI(serviceId);
      }

      function updateServiceUI(serviceId) {
        const state = serviceStates[serviceId];

        // Update status indicator
        const indicator = document.getElementById(`indicator-${serviceId}`);
        indicator.className = `status-indicator ${state.status}`;

        // Update status text
        const statusEl = document.getElementById(`status-${serviceId}`);
        let statusText = "";
        let statusClass = "";

        switch (state.status) {
          case "healthy":
            statusText = "‚úÖ Healthy";
            statusClass = "status-healthy";
            break;
          case "degraded":
            statusText = state.error ? `‚ö†Ô∏è ${state.error}` : "‚ö†Ô∏è Slow";
            statusClass = "status-degraded";
            break;
          case "down":
            statusText = `‚ùå ${state.error || "Down"}`;
            statusClass = "status-down";
            break;
          default:
            statusText = "‚è≥ Checking...";
            statusClass = "";
        }

        statusEl.textContent = statusText;
        statusEl.className = `detail-value ${statusClass}`;

        // Update response time
        const responseEl = document.getElementById(`response-${serviceId}`);
        if (state.responseTime !== null) {
          const rt = state.responseTime;
          responseEl.textContent =
            rt < 1000 ? `${rt}ms` : `${(rt / 1000).toFixed(2)}s`;

          // Color code response time
          if (rt < 500) {
            responseEl.style.color = "#10b981"; // Green
          } else if (rt < 2000) {
            responseEl.style.color = "#f59e0b"; // Yellow
          } else {
            responseEl.style.color = "#ef4444"; // Red
          }
        }

        // Update last check time
        const lastCheckEl = document.getElementById(`lastcheck-${serviceId}`);
        if (state.lastCheck) {
          lastCheckEl.textContent = formatTime(state.lastCheck);
        }
      }

      // ============================================
      // AUTO-REFRESH CONTROL
      // ============================================
      function startAutoRefresh() {
        if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
        }

        autoRefreshInterval = setInterval(() => {
          if (autoRefreshEnabled) {
            checkAllServices();
          }
        }, CONFIG.checkInterval);
      }

      function toggleAutoRefresh() {
        autoRefreshEnabled = !autoRefreshEnabled;
        const button = document.getElementById("autoRefreshText");

        if (autoRefreshEnabled) {
          button.textContent = "‚è∏Ô∏è Pause Auto-Refresh";
          checkAllServices();
        } else {
          button.textContent = "‚ñ∂Ô∏è Resume Auto-Refresh";
        }
      }

      // ============================================
      // UTILITY FUNCTIONS
      // ============================================
      function updateLastUpdatedTime() {
        const lastUpdatedEl = document.getElementById("lastUpdated");
        lastUpdatedEl.textContent = formatTime(new Date());
      }

      function formatTime(date) {
        return date.toLocaleTimeString("en-US", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });
      }

      // ============================================
      // KEYBOARD SHORTCUTS
      // ============================================
      document.addEventListener("keydown", (e) => {
        // Press 'R' to refresh
        if (e.key === "r" || e.key === "R") {
          checkAllServices();
        }
        // Press 'Space' to toggle auto-refresh
        if (e.key === " " && e.target === document.body) {
          e.preventDefault();
          toggleAutoRefresh();
        }
      });
    </script>
  </body>
</html>
